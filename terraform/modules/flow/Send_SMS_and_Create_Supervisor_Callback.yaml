workflow:
  name: {{flow_name}}
  description: ""
  division: {{division}}
  startUpRef: "/workflow/states/state[Get Sentiment Score_37]"
  defaultLanguage: {{default_language}}
  supportedLanguages:
    en-us:
      none: true
  variables:
    - stringVariable:
        name: Flow.ani
        initialValue:
          noValue: true
        isInput: true
        isOutput: false
    - stringVariable:
        name: Flow.CallbackError
        initialValue:
          noValue: true
        isInput: false
        isOutput: false
    - dateTimeVariable:
        name: Flow.CallbackTime
        initialValue:
          noValue: true
        isInput: false
        isOutput: false
    - stringVariable:
        name: Flow.CallerAni
        initialValue:
          noValue: true
        isInput: true
        isOutput: false
    - stringVariable:
        name: Flow.caseId
        initialValue:
          noValue: true
        isInput: true
        isOutput: false
    - stringVariable:
        name: Flow.conversationId
        initialValue:
          noValue: true
        isInput: true
        isOutput: false
    - stringVariable:
        name: Flow.converstationId
        initialValue:
          noValue: true
        isInput: true
        isOutput: false
    - dateTimeVariable:
        name: Flow.CurrentDateTime
        initialValue:
          noValue: true
        isInput: false
        isOutput: false
  settingsErrorHandling:
    errorHandling:
      endWorkflow:
        none: true
  states:
    - state:
        name: Get Sentiment Score
        refId: Get Sentiment Score_37
        variables:
          - stringVariable:
              name: State.ErrorCode
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
          - integerVariable:
              name: State.ErrorStatus
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
          - decimalVariable:
              name: State.SentimentScore
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
        actions:
          - wait:
              name: Wait
              trimDurationNearMaxRunningTime:
                lit: false
              duration:
                lit:
                  minutes: 1
          - callData:
              name: Call Data Action
              timeout:
                lit:
                  minutes: 1
              category:
                {{data_action_category}}:
                  dataAction:
                    {{get_sentiment_name}}:
                      inputs:
                        conversationid:
                          exp: Flow.conversationId
                      successOutputs:
                        sentimentScore:
                          var: State.SentimentScore
                        sentimentTrend:
                          noValue: true
                      failureOutputs:
                        errorCode:
                          var: State.ErrorCode
                        status:
                          var: State.ErrorStatus
                        correlationId:
                          noValue: true
                        entityId:
                          noValue: true
                        entityName:
                          noValue: true
                        userMessage:
                          noValue: true
                        userParamsMessage:
                          noValue: true
                        userParams.key:
                          noValue: true
                        userParams.value:
                          noValue: true
                        details.errorCode:
                          noValue: true
                        details.fieldName:
                          noValue: true
                        details.entityId:
                          noValue: true
                        details.entityName:
                          noValue: true
              outputs:
                success:
                  actions:
                    - decision:
                        name: Decision
                        condition:
                          exp: State.SentimentScore < 1
                        outputs:
                          "yes":
                            actions:
                              - callData:
                                  name: Call Data Action
                                  timeout:
                                    lit:
                                      minutes: 1
                                  category:
                                    {{data_action_category}}:
                                      dataAction:
                                        {{send_agentless_sms_name}}:
                                          inputs:
                                            fromAddress:
                                              lit: "{{sms_number}}"
                                            toAddress:
                                              exp: right(flow.ani,12)
                                            toAddressMessengerType:
                                              lit: sms
                                            textBody:
                                              exp: "\"INTERACTION ALERT!!! Conversation ID :\" + Flow.conversationId + \" needs to be reviewed. This interaction was less than ideal with a Sentiment score of \" + Left(ToString(State.SentimentScore), 4) + \".\""
                                          successOutputs:
                                            status:
                                              noValue: true
                                          failureOutputs:
                                            errorCode:
                                              noValue: true
                                            status:
                                              noValue: true
                                            correlationId:
                                              noValue: true
                                            entityId:
                                              noValue: true
                                            entityName:
                                              noValue: true
                                            userMessage:
                                              noValue: true
                                            userParamsMessage:
                                              noValue: true
                                            userParams.key:
                                              noValue: true
                                            userParams.value:
                                              noValue: true
                                            details.errorCode:
                                              noValue: true
                                            details.fieldName:
                                              noValue: true
                                            details.entityId:
                                              noValue: true
                                            details.entityName:
                                              noValue: true
                                  outputs:
                                    success:
                                      actions:
                                        - updateData:
                                            name: Update Data
                                            statements:
                                              - dateTime:
                                                  variable: Flow.CurrentDateTime
                                                  value:
                                                    exp: GetCurrentDateTimeUtc()
                                              - dateTime:
                                                  variable: Flow.CallbackTime
                                                  value:
                                                    exp: AddMinutes(Flow.CurrentDateTime,1)
                                        - callData:
                                            name: Call Data Action
                                            timeout:
                                              lit:
                                                minutes: 1
                                            category:
                                              {{data_action_category}}:
                                                dataAction:
                                                  {{create_scheduled_callback_name}}:
                                                    inputs:
                                                      scriptId:
                                                        noValue: true
                                                      queueId:
                                                        lit: {{callback_queue}}
                                                      phone:
                                                        exp: tophonenumber(Flow.CallerAni)
                                                      dateTime:
                                                        exp: Flow.CallbackTime
                                                    failureOutputs:
                                                      errorCode:
                                                        var: Flow.CallbackError
                                                      status:
                                                        noValue: true
                                                      correlationId:
                                                        noValue: true
                                                      entityId:
                                                        noValue: true
                                                      entityName:
                                                        noValue: true
                                                      userMessage:
                                                        noValue: true
                                                      userParamsMessage:
                                                        noValue: true
                                                      userParams.key:
                                                        noValue: true
                                                      userParams.value:
                                                        noValue: true
                                                      details.errorCode:
                                                        noValue: true
                                                      details.fieldName:
                                                        noValue: true
                                                      details.entityId:
                                                        noValue: true
                                                      details.entityName:
                                                        noValue: true
                                        - callData:
                                            name: UseUpdate External Tag with Customer Dissatisfaction
                                            timeout:
                                              lit:
                                                minutes: 1
                                            category:
                                              {{data_action_category}}:
                                                dataAction:
                                                  {{update_external_tag_name}}:
                                                    inputs:
                                                      ConversationID:
                                                        exp: Flow.conversationId
                                                      externalTag:
                                                        lit: Supervisor Alerted
                                                    failureOutputs:
                                                      errorCode:
                                                        noValue: true
                                                      status:
                                                        noValue: true
                                                      correlationId:
                                                        noValue: true
                                                      entityId:
                                                        noValue: true
                                                      entityName:
                                                        noValue: true
                                                      userMessage:
                                                        noValue: true
                                                      userParamsMessage:
                                                        noValue: true
                                                      userParams.key:
                                                        noValue: true
                                                      userParams.value:
                                                        noValue: true
                                                      details.errorCode:
                                                        noValue: true
                                                      details.fieldName:
                                                        noValue: true
                                                      details.entityId:
                                                        noValue: true
                                                      details.entityName:
                                                        noValue: true
                                        - callData:
                                            name: Call Data Action
                                            timeout:
                                              lit:
                                                minutes: 1
                                            category:
                                              {{data_action_category}}:
                                                dataAction:
                                                  {{send_chat_group_notif_name}}:
                                                    inputs:
                                                      message:
                                                        exp: "\"INTERACTION ALERT!!! Conversation ID :\" + Flow.conversationId + \" needs to be reviewed. This interaction was less than ideal with a Sentiment score of \" + Left(ToString(State.SentimentScore), 4) + \".\""
                                                      metadata:
                                                        lit: JVM
                                                    failureOutputs:
                                                      errorCode:
                                                        noValue: true
                                                      status:
                                                        noValue: true
                                                      correlationId:
                                                        noValue: true
                                                      entityId:
                                                        noValue: true
                                                      entityName:
                                                        noValue: true
                                                      userMessage:
                                                        noValue: true
                                                      userParamsMessage:
                                                        noValue: true
                                                      userParams.key:
                                                        noValue: true
                                                      userParams.value:
                                                        noValue: true
                                                      details.errorCode:
                                                        noValue: true
                                                      details.fieldName:
                                                        noValue: true
                                                      details.entityId:
                                                        noValue: true
                                                      details.entityName:
                                                        noValue: true
                                        - endWorkflow:
                                            name: End Workflow
                                            exitReason:
                                              lit: Success
                                    failure:
                                      actions:
                                        - endWorkflow:
                                            name: End Workflow
                                            exitReason:
                                              lit: Failure
                                    timeout:
                                      actions:
                                        - endWorkflow:
                                            name: End Workflow
                                            exitReason:
                                              lit: Failure
                          "no":
                            actions:
                              - endWorkflow:
                                  name: End Workflow
                                  exitReason:
                                    lit: Success
                failure:
                  actions:
                    - endWorkflow:
                        name: End Workflow
                        exitReason:
                          lit: Success
                timeout:
                  actions:
                    - endWorkflow:
                        name: End Workflow
                        exitReason:
                          lit: Success
